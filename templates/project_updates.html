<nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main">
    <br />
    <ng-include src="'side_nav.html'" ng-controller="SideNavCtrl"></ng-include>
  </nav>
  <div class="main-content">
    <!-- Navbar -->
    <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
      <div class="container-fluid">
        <!-- Brand -->
  
        <span>
          <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="#">
            Project Updates Dashboard
          </a>
        </span>
  
        <!-- <span ng-if="user_info.role != 'admin'">
  
          <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block badge badge-info" href="#"
            ng-click="get_statics_developer_for_developer('psta', user_info.department_id, user_info.is_dept_head, user_info.user_id, user_info.user_role)">
            My Projects
          </a>
  
        </span> -->
  
        <!-- <span ng-if="admin_or_assigner_can_see">
          <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block badge badge-info" href="#"
            ng-click="get_statics_developer_for_assigner_and_admin('psta')">
            Admin Dashboard
          </a>
          &nbsp;&nbsp;&nbsp;&nbsp;
        </span> -->
  
        <!-- ng-model="get_statics_developer_for_developer('psta', user_info.department_id, user_info.is_dept_head, user.user_id, user.user_role)" -->
  
        <!-- <div class="col-xl-4">
          <select class="form-control" ng-click="get_statics_developer_for_developer('psta', 104, 0, 115)">
            <option value="">-- Filter by Developer --</option>
            <option ng-repeat="user in all_users" ng-model="user_id_" ng-value="user.user_id" ng-hide="user.user_id == '1'" >
              {{user.f_name}} {{user.l_name}} </option>
          </select>
        </div> -->
  
        
  
        <!-- User -->
        <ul class="navbar-nav align-items-center d-none d-md-flex">
          <li class="nav-item dropdown">
            <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              <div class="media align-items-center">
                <span class="avatar avatar-sm rounded-circle" ng-if="profile_pic_true == null">
                  <span ng-if="user_info.gender == 'Male'">
                    <img src="./assets/img/theme/m_profile_icon.jpg" class="rounded-circle" />
                  </span>
                  <span ng-if="user_info.gender == 'Female'">
                    <img src="./assets/img/theme/f_profile_icon.png" class="rounded-circle" />
                  </span>
                  <!-- <img alt="Image placeholder" src="./assets/img/theme/team-4-800x800.jpg"> -->
                </span>
  
                <span class="avatar avatar-sm rounded-circle" ng-if="profile_pic_true != null">
                  <img alt="Image placeholder" ng-src="{{ profile_pic }}" />
                </span>
  
                <div class="media-body ml-2 d-none d-lg-block">
                  <span class="mb-0 text-sm  font-weight-bold text-uppercase">{{user_info.username}}</span>
                </div>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
              <div class=" dropdown-header noti-title">
                <h6 class="text-overflow m-0">Welcome {{user_info.username}}</h6>
              </div>
              <a href="profile" class="dropdown-item">
                <i class="ni ni-single-02"></i>
                <span>My profile</span>
              </a>
              <a class="dropdown-item">
                <i class="ni ni-settings-gear-65"></i>
                <span>Settings</span>
              </a>
              <a class="dropdown-item">
                <i class="ni ni-calendar-grid-58"></i>
                <span>Activity</span>
              </a>
              <a class="dropdown-item">
                <i class="ni ni-support-16"></i>
                <span>Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" ng-click="logout()">
                <i class="ni ni-user-run"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>
      </div>
    </nav>
    <!-- End Navbar -->
    <!-- Header -->
    <div class="header bg-gradient-primary pb-8 pt-5 pt-md-6">
      <div class="container-fluid">
        <div class="header-body">
          <!-- Card stats -->
          <div class="row">
            <!-- <div class="col-xl-3 col-lg-6 dash_card" ng-click="get_total_projects(user_info.user_id, total_projects.description, _user_info_role,
              user_info.department_id)">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col-auto">
                      <div class="icon icon-shape bg-primary text-white rounded-circle shadow">
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">
                        {{ total_projects.description }}
                      </h5>
                      <span class="h2 font-weight-bold mb-0">{{ total_projects.total_projects }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <legend></legend>
            </div> -->
  
  
  
            <div class="col-xl-3 col-lg-6 dash_card" ng-repeat="status in status_of_project" ng-click="get_tasks_by_status_id(user_info.user_id, status.status_id, status.status, _user_info_role,
              user_info.department_id)">
              <div class="card card-stats mb-4 mb-xl-0">
                <div class="card-body">
                  <div class="row">
                    <div class="col-auto">
                      <div class="icon icon-shape bg-{{ status.code_color }} text-white rounded-circle shadow">
                        <i class="ni ni-settings"></i>
                      </div>
                    </div>
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">
                        {{ status.status}}
                      </h5>
                      <span class="h2 font-weight-bold mb-0">{{ status.status_count}}</span>
                    </div>
                  </div>
                </div>
              </div>
              <legend></legend>
            </div>
  
          </div>
        </div>
      </div>
    </div>
  
    <div class="container-fluid mt--8">
      <!-- Table -->
      <br>
      <!-- Table -->
      <div class="row">
        <div class="col-md-4">
          <!-- ng-click="getDownloadProjectUpdates()" -->
          <a class=" h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="#" id="btnExport" title="click here download table contents">
            ( {{ projects.length }} ) - {{ statistics_description_name }}
            projects &nbsp; &nbsp;<span class="ni ni-cloud-download-95"></span>
          </a>
        </div>
        <div class="col-md-8">
          <div class="row">
            <!-- <div class="col-xl-3">
              <input class="form-control" placeholder="Start Date" type="date" ng-model="tableSearch_by_start_date" style="height: auto;">
            </div>
            <div class="col-xl-3">
              <input class="form-control" placeholder="End Date" type="date" ng-model="tableSearch_by_end_date" style="height: auto;">
            </div> -->
            <div class="col-xl-3"></div>
            <div class="col-xl-3"></div>
            <div class="col-xl-3">
              <!-- <select class="form-control " required ng-model="tableSearch_by_department_id">
                <option value="">--Filter by Department--</option>
                <option ng-value="department.code_desc_id" ng-repeat="department in departments">{{department.code_desc}}
                </option>
              </select> -->
            </div>
            <!-- <div class="col-xl-3"></div> -->
            <!-- <div class="col-xl-2"></div> -->
            <!-- <div class="col-xl-3">
              <select class="form-control " required ng-model="tableSearch_by_status_id">
                <option value="">-- project Status--</option>
                <option ng-value="status.status_id" ng-repeat="status in status_of_project">{{ status.status}}</option>
              </select>
            </div> -->
            <!-- <div class="col-xl-2">
                <button class="btn btn-info text-uppercase" ng-click="apply_filter(filter_department, filter_status)">apply</button>
              </div> -->
            <div class="col-xl-2">
              <!-- <button class="btn btn-info text-uppercase" ng-click="clear_filter()">clear</button> -->
            </div>
          </div>
        </div>
      </div>
  
      <div class="col">
        <legend></legend>
        <div class="card shadow">
          <h5 class="card-title display-4 text-primary text-center float-center" ng-if="!projects">
            <br />
            No Project Available
          </h5>
  
          <div class="table-responsive" ng-if="projects">
            <!-- <form ng-submit="downloadExcelSheet()" ng-show="user_info.is_dept_head == '1' ">
              <div class="col-4 text-left" >
                
                <input type="number" hidden class="form-control" id="dept_id" ng-value="" ng-model="dept_id">
                <button ng-click = downloadExcel() class="btn btn-sm btn-primary">last Update</button> -->
                <!-- <a href="#!">Save Changes</a> -->
              <!-- </div>
            </form> -->
            <legend></legend>
  
            <table class="table align-items-center table-flush" id="updatesTable">
              <thead class="thead-light">
                <tr>
                  <th scope="col">Project ID</th>
                  <th scope="col">Description</th>
                  <th scope="col">Task Id</th>
                  <th scope="col">Owner</th>
                  <th scope="col">Start Date</th>
                  <th scope="col">End Date</th>
                  <th scope="col">Rate</th>
                  <th scope="col">Department</th>
                  <th scope="col">Last Update Date</th>
                  <th scope="col">Last Update</th>
                  
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="project in projects | filter:{ 'department_id':tableSearch_by_department_id, 'start_date': tableSearch_by_start_date, 'end_date': tableSearch_by_end_date} | filter: tableSearch">
                  <th scope="row">
                    <div class="media align-items-center">
                      <a href="project/{{ project.project_id }}">PROJ-0000{{project.project_id}}
                      </a>
                      <!-- PROJ-0000{{project.project_id}} -->
                    </div>
                  </th>              
                  <td style="max-width: 300px;">
                    <div class="col-12 text-truncate" data-toggle="tooltip" data-placement="top"
                      title="{{ project.name }}">
                      {{ project.name }}
                      <!-- <a href="project/{{project.project_id}}" >{{project.name}}</a> -->
                    </div>
                  </td>
                  <td>
                    <div class="media align-items-center">
                      <a href="task_detail/{{project.task_id}}">REF-0000{{project.task_id}}
                      </a>
                      <!-- PROJ-0000{{project.project_id}} -->
                    </div>
                  </td>
                  <td>
                    {{ project.owner }}
                  </td>
                  <td>
                    {{ project.start_date | date: mediumDate}}
                  </td>
                  <td>
                    {{ project.end_date | date: mediumDate}}
                  </td>
                  <td>
                    <div class="d-flex align-items-center text-{{ percentage_color }}" ng-if="project.completion == null">
                      <span class="mr-2">0 %</span>
                    </div>
                    <div class="d-flex align-items-center text-{{ percentage_color }}" ng-if="project.completion != null">
                      <span class="mr-2">{{ project.completion | number }} %</span>
                    </div>
                  </td>
                  <td>
                    <span class="text-camelcase"></span>
                    {{ project.department }}
                  </td>
                  <td>
                      <span class="text-camelcase">
                          {{ project.last_update_date }}
                      </span>
                  </td>
                  <td>
                     <span class="text-camelcase">
                      {{ project.last_update }}
                     </span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>


    $(document).ready(function () {
      var table = $('#data_table').DataTable({
        lengthChange: false,
        buttons: ['copy', 'excel', 'pdf', 'colvis']
      });
  
      table.buttons().container()
        .appendTo('#example_wrapper .col-md-6:eq(0)');
    });
  
    $(document).ready(function () {
      // $("#data_table").DataTable();
      $("#btnExport").click(function (e) {

          var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
          var textRange; var j=0;
          tab = document.getElementById('updatesTable'); // id of table

          for(j = 0 ; j < tab.rows.length ; j++)
          {
              tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
              //tab_text=tab_text+"</tr>";
          }

          tab_text=tab_text+"</table>";
          tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
          tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
          tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

          var ua = window.navigator.userAgent;
          var msie = ua.indexOf("MSIE ");

          if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
          {
              txtArea1.document.open("txt/html","replace");
              txtArea1.document.write(tab_text);
              txtArea1.document.close();
              txtArea1.focus();
              sa=txtArea1.document.execCommand("SaveAs",true,"Say Thanks to Sumit.xls");
          }
          else                 //other browser not tested on IE 11
              sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));
      });

    });
    console.log("this is new "+department_id);
    function downloadExcel(){
      window.location.href= "./apiSheet/projectReportByDeptId.php";
    }

      function exportTableToExcel(tableID, filename = ''){
          var downloadLink;
          var dataType = 'application/vnd.ms-excel';
          var tableSelect = document.getElementById(tableID);
          var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
          
          // Specify file name
          filename = filename?filename+'.xls':'excel_data.xls';
          
          // Create download link element
          downloadLink = document.createElement("a");
          
          document.body.appendChild(downloadLink);
          
          if(navigator.msSaveOrOpenBlob){
              var blob = new Blob(['\ufeff', tableHTML], {
                  type: dataType
              });
              navigator.msSaveOrOpenBlob( blob, filename);
          }else{
              // Create a link to the file
              downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
          
              // Setting the file name
              downloadLink.download = filename;
              
              //triggering the function
              downloadLink.click();
          }
      }
  </script>
  </div>