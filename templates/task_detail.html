<nav class="navbar navbar-vertical fixed-left navbar-expand-md navbar-light bg-white" id="sidenav-main"><br>
  <ng-include src="'./side_nav.html'" ng-controller="SideNavCtrl"></ng-include>
</nav>

<div class="main-content">
  <!-- Navbar -->
  <nav class="navbar navbar-top navbar-expand-md navbar-dark" id="navbar-main">
    <div class="container-fluid">
      <!-- Brand -->
      <!-- <span class="text-white"><i class="fa fa-arrow-left 2x"></i>&nbsp;&nbsp; &nbsp;&nbsp;Return to Tasks</span> -->
      <a class="h4 mb-0 text-white text-uppercase d-none d-lg-inline-block" href="project/{{project.project_id}}"> <i
          class="fa fa-arrow-left 2x"></i>&nbsp;&nbsp; &nbsp;&nbsp;Return </a>

      <form class="navbar-search navbar-search-dark form-inline mr-3 d-none d-md-flex ml-lg-auto">
        <div class="form-group mb-0">
          <div class="input-group input-group-alternative">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fas fa-search"></i></span>
            </div>
            <input class="form-control" placeholder="Search" type="text" ng-model="tableSearch" style="height: auto;">
          </div>
        </div>
      </form>


      <!-- User -->
      <ul class="navbar-nav align-items-center d-none d-md-flex">
        <li class="nav-item dropdown">
          <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <div class="media align-items-center">

              <span class="avatar avatar-sm rounded-circle" ng-if="profile_pic_true == null">
                <span ng-if="user_info.gender == 'Male'">
                  <img src="./assets/img/theme/m_profile_icon.jpg" class="rounded-circle">
                </span>
                <span ng-if="user_info.gender == 'Female'">
                  <img src="./assets/img/theme/f_profile_icon.png" class="rounded-circle">
                </span>
                <!-- <img alt="Image placeholder" src="./assets/img/theme/team-4-800x800.jpg"> -->
              </span>

              <span class="avatar avatar-sm rounded-circle" ng-if="profile_pic_true != null">
                <img alt="Image placeholder" ng-src="{{ profile_pic }}">
              </span>


              <div class="media-body ml-2 d-none d-lg-block">
                <span class="mb-0 text-sm  font-weight-bold text-uppercase">{{user_info.username}}</span>
              </div>
            </div>
          </a>
          <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
            <div class=" dropdown-header noti-title">
              <h6 class="text-overflow m-0">Welcome {{user_info.username}}</h6>
            </div>
            <a href="profile" class="dropdown-item">
              <i class="ni ni-single-02"></i>
              <span>My profile</span>
            </a>
            <a class="dropdown-item">
              <i class="ni ni-settings-gear-65"></i>
              <span>Settings</span>
            </a>
            <a class="dropdown-item">
              <i class="ni ni-calendar-grid-58"></i>
              <span>Activity</span>
            </a>
            <a class="dropdown-item">
              <i class="ni ni-support-16"></i>
              <span>Support</span>
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" ng-click="logout()">
              <i class="ni ni-user-run"></i>
              <span>Logout</span>
            </a>
          </div>
        </li>
      </ul>
    </div>
  </nav>
  <!-- End Navbar -->
  <!-- Header -->
  <div class="header bg-gradient-primary pb-5 pt-5 pt-md-8">
    <div class="container-fluid">
      <div class="header-body">

      </div>
    </div>
  </div>
  <div class="container-fluid mt--7">
    <!-- Table -->




    <div class="row">
      <div class="col-md-7">

        <div class="card shadow">
          <div class="card-header border-0">

            <div class="row">
              <div class="col-md-12">
                <span class="card-title text-primary text-uppercase">PRO-0000{{ project.project_id }} -
                  {{ project.project_name }}

                </span>

                <br>
              </div>


              <div class="col-md-6">
                <span class="text-primary">Version:</span>
                &nbsp;&nbsp;{{ project.version_name }}
              </div>
              <div class="col-md-6">
                <span class="text-primary">Department:</span>
                &nbsp;&nbsp;<span class="">{{ project.department_name }}</span>
              </div>

              <div class="col-md-6">
                <span class="text-primary">Start Date: </span>
                &nbsp;&nbsp;{{ project.project_start_date | date: mediumDate }}
              </div>
              <div class="col-md-6">
                <span class="text-primary">End Date :</span>
                &nbsp;&nbsp;<span class="">{{ project.project_end_date | date: mediumDate }}</span>
              </div>

              <div class="col-md-6">
                <span class=" badge badge-success" ng-if="project.is_approved == '1'">Approved</span>
                <span class=" badge badge-danger" ng-if="project.is_approved == '0'">Not Approved</span>
              </div>
              <!-- <div class="col-md-4"> -->
              <!-- <div class="icon icon-shape bg-{{percentage_color}} text-white rounded-circle shadow "
                      id="card-percentage__tasks">
                      {{project_avg | number: 0}}%
                    </div> -->
              <!-- </div> -->


            </div>
            <br>

            <div class="row">

              <div class="col-md-12">

              </div>

              <br>

              <div class="col-md-12">
                <div class="progress">
                  <div class="progress-bar bg-{{progress_bar_percentage_color}}" role="percentage_completion"
                    aria-valuenow="{{percentage_completion}}" aria-valuemin="0"
                    aria-valuemax="{{percentage_completion}}" style="width: {{percentage_completion}}%">
                  </div>

                </div>
                <h5 class="text-{{progress_bar_percentage_color}} text-center">Number of days Left:
                  {{ number_of_days_till_end }} </h5>
                <br>
                <!-- <h5 class="card-title">

                  <div class="float-left text-success"><i class="ni ni-bold-up"></i></div>
                  <div class="float-right text-danger"><i class="ni ni-bold-up"></i></div>
                  <br>
                  <div class="float-left text-success">{{ oneTask.start_date | date: mediumDate}}</div>
                  <div class="float-right text-danger">{{ oneTask.end_date | date: mediumDate}}</div> -->



              </div>
              <!-- 
                  <div class="col-md-12"> 
                      
                    <div class="progress">
                      <div class="progress-bar bg-{{progress_bar_percentage_color}}" role="progressbar" aria-valuenow="{{progress_bar_percentage}}" aria-valuemin="0"
                        aria-valuemax="{{progress_bar_percentage}}" style="width: {{progress_bar_percentage}}%">
                      </div>
                    
                    </div>
                  </div> -->

              <div class="col-md-12">
                <span class="text-primary">Task:</span>
                &nbsp;&nbsp;REF-0000{{oneTask.task_id}} - {{oneTask.task_description}}
              </div>




              <div class="col-md-12" id="card-percentage__tasks">
                <div class="icon icon-shape bg-{{progress_bar_percentage_color}} text-white rounded-circle shadow ">
                  {{percentage_completion}}%
                </div>


              </div>

              <div class="col-md-12">
                <span class="text-primary">Priority:</span>
                &nbsp;&nbsp;<span class="">{{oneTask.priority}}</span>
              </div>
              <!-- <div class="col-md-4"> -->
              <!-- <div class="icon icon-shape bg-{{percentage_color}} text-white rounded-circle shadow "
                      id="card-percentage__tasks">
                      {{project_avg | number: 0}}%
                    </div> -->
              <!-- </div> -->

              <div class="col-md-12">
                <span class="text-primary">Task Detail: </span>
                &nbsp;&nbsp;{{oneTask.task_description}}
              </div>

              <div class="col-md-12">
                <span class="text-primary">Task Status: </span>
                &nbsp;&nbsp;{{ oneTask.status}}
              </div>

              <div class="col-md-12">
                <span class="text-primary">Client: </span>
                &nbsp;&nbsp;{{oneTask.client}}
              </div>
              <div class="col-md-12">
                <span class="text-primary">Assigned By: </span>
                &nbsp;&nbsp;{{oneTask.assigned_by}}
              </div>
              <div class="col-md-12">
                <span class="text-primary">Assigned To: </span>
                &nbsp;&nbsp;{{oneTask.assigned_to}}
              </div>
              <div class="col-md-12">
                <span class="text-primary">Start Date: </span>
                &nbsp;&nbsp;{{ oneTask.task_start_date | date: mediumDate}}
              </div>
              <div class="col-md-12">
                <span class="text-primary">End Date: </span>
                &nbsp;&nbsp;{{ oneTask.task_end_date | date: mediumDate}}
              </div>
              <div class="col-md-12" ng-if="user_info.role == 'assigner'">
                <div class="">
                  <a
                    ng-href="edit_task?project_id={{ oneTask.project_id }}&task_id={{ oneTask.task_id }}&project_name={{ oneTask.task_description }}&department_id={{ oneTask.department_id}}&start_date={{ oneTask.project_start_date}}&end_date={{ oneTask.project_end_date}}">
                    <button class="btn btn-sm btn-primary">Edit REF-0000{{ oneTask.task_id }}</button>
                  </a>
                </div>
              </div>


            </div>





            <!-- HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH -->






          </div>

        </div>

        <legend></legend>
        <div class="card shadow" ng-hide="project.is_approved == '0'" ng-if="developer_can_see">
          <div class="card-header border-0 ">

            <p class="card-text">


              <!-- <div class="row" ng-if="user_info.role != 'assigner' " ng-if="user_info.role != 'guest' "> -->
              <div class="row">

                <div class="col-sm-3 col-md-3">
                  <div class="form-group">

                    <span class="text-primary"> Status</span>

                    <select class="form-control-sm" id="exampleFormControlSelect1" ng-model="taskStatus">
                      <option value=""> {{ oneTask.status}}</option>
                      <option ng-repeat="code in code_desc" ng-value="code.code_desc_id">
                        {{ code.code_desc }}</option>
                    </select>
                  </div>
                </div>

                <div class="col-sm-4 col-md-4 text-center " ng-hide="hide_when_status_is_not_started">
                  <div class="form-group">

                    <span class="text-primary">Go for Testing </span><br>

                    <label class="custom-toggle">
                      <input type="checkbox" checked ng-model="ready_for_test ">
                      <span class="custom-toggle-slider rounded-circle"></span>
                    </label>
                  </div>
                </div>


                <div class="col-sm-4 col-md-4 text-center " ng-hide="hide_when_status_is_not_started">
                  <div class="form-group">

                    <span class="text-primary">Completion</span><br>

                    <select class="form-control-sm" id="exampleFormControlSelect1" ng-model="percentage_completion">
                      <option value="10">10</option>
                      <option value="20">20</option>
                      <option value="30">30</option>
                      <option value="40">40</option>
                      <option value="50">50</option>
                      <option value="60">60</option>
                      <option value="70">70</option>
                      <option value="80">80</option>
                      <option value="90">90</option>
                      <option value="100">100</option>
                    </select>
                  </div>
                </div>

                <p>
                  <div class="container">

                    <button class="btn btn-sm btn-success float-left"
                      ng-click="saveTaskUpdate(taskStatus, ready_for_test, percentage_completion)">
                      Save Update
                    </button>

                  </div>
                </p>

              </div>



            </p>
          </div>

        </div>


      </div>
      <div class="col-md-5">
        <div class="shadow">
          <div class="card-header border-0  bg-secondary col-md-12" id="div_comment-box__task_detail">
            <h4 class="text-primary">Comments and Updates

              <!-- <span class="float-right"  > 
                                <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="ni ni-album-2 text-primary"></i>
                                  </a>  
                            </span> -->
              <ul class="navbar-nav align-items-right d-none d-md-flex float-right">
                <li class="nav-item dropdown">
                  <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">
                    <div class="media align-items-center">
                      <span class="avatar avatar-sm rounded-circle bg-primary">
                        <i class="ni ni-album-2 text-white"></i>
                      </span>

                    </div>
                  </a>
                  <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
                    <div class=" dropdown-header noti-title">
                      <h6 class="text-overflow m-0">( {{ all_attachment_file.length }} ) Attachment Files ! </h6>
                    </div>
                    <a href="examples/profile.html" ng-repeat="file in all_attachment_file"
                      ng-href="{{myConfig_file_url}}{{file.attach}}" target="_blank" download class="dropdown-item">
                      <i class="ni ni-album-2 text-primary"></i>
                      <span>{{ file.attach }}</span>
                    </a>

                  </div>
                </li>
              </ul>
            </h4>



            <hr id="hr_remove_margin">
            <div id="comment-box__task_detail col-md-12">
              <legend></legend>
              <div class="" id="comm_box_height">

                <div class="alert alert-secondary bg-white " id="message-bubble-others__task_detail" role="alert"
                  ng-repeat="comment in comments | filter: tableSearch">
                  <div class="clearfix ">
                    <span class="float-left small text-primary">
                      {{comment.posted_by_name}}
                    </span>
                    <span class="float-right small text-warning">
                      {{comment.comment_date | myDateFormat}}
                    </span>
                  </div>
                  <div>
                    {{comment.comment}}
                    <a ng-href="{{myConfig_file_url}}{{comment.attach}}" target="_blank" download>
                      <strong ng-if="comment.attach != ''">
                        &nbsp; &nbsp; <i class="fa fa-paperclip text-blue" id=""></i>
                      </strong>
                    </a>

                    <br>
                    <a href="#" class="badge badge-info" data-toggle="modal" data-target="#modal-reply-comment"
                      ng-click="open_modal_comment(comment)" ng-if="developer_can_see">Reply</a>
                  </div>

                  <div class="alert alert-default " id="message-bubble-user__task_detail" role="alert"
                    ng-repeat="reply in comment.reply  | filter: tableSearch" ng-hide="reply.reply_id == null">
                    <div class="clearfix">
                      <span class="float-left small ">
                        {{reply.replied_by_name}} {{file_data}}
                      </span>
                      <span class="float-right small ">
                        {{ reply.reply_date | myDateFormat}}
                      </span>
                    </div>
                    {{reply.reply}}

                  </div>

                </div>



              </div>

            </div>


          </div>
          <!-- Input box section -->
          <!-- <form method="post" enctype="multipart/form-data" id="comment_input_form" ng-if="user_info.role != 'assigner' " ng-hide="project.is_approved == '0' "
            ng-if=" user_info.role != 'guest'"> -->
          <form method="post" enctype="multipart/form-data" id="comment_input_form"
            ng-hide="project.is_approved == '0' " ng-if="project.assigned_to_id == user_info.user_id">
            <div class="col-md-12">
              <div class="small">
                Attachment: <span class="text-primary" id="show_attach_name">{{attachment_file}}</span>
              </div>

              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="validationTooltipUsernamePrepend">
                    <i class="fa fa-paperclip text-blue" id="attachment-icon"
                      onclick="document.getElementById('attached-file').click();" ng-click="get_file_input()"></i>
                  </span>
                </div>

                <textarea name="" id="" class="form-control" id="task_comment_input" placeholder="Type here ..."
                  aria-describedby="validationTooltipUsernamePrepend" required ng-model="comment_message">

                                    </textarea>
                <div class="input-group-prepend" ng-click="sendComment(task_id, comment_message, user_info.user_id)">
                  <span class="input-group-text" id="validationTooltipUsernamePrepend">
                    <i class="ni ni-send text-primary"></i>
                  </span>
                </div>
              </div>




              <input type="file" id="attached-file" style="display: none;" ng-model="attach_file">

              <!--End Input box section -->
              <br>


            </div>
          </form>
        </div>
      </div>

      <!-- Reply Comment modal -->
      <div class="modal fade" id="modal-reply-comment" tabindex="-1" role="dialog" aria-labelledby="modal-reply-comment"
        aria-hidden="true">
        <div class="modal-dialog modal- modal-dialog-centered modal-sm" role="document">
          <div class="modal-content">
            <div class="modal-body p-0">
              <div class="card bg-secondary shadow border-0">

                <div class="card-body px-lg-5 py-lg-4">
                  <div class="text-left text-muted ">
                    <div class="alert alert-default" role="alert">
                      <span id="display_reply_comment"></span>
                    </div>
                  </div>
                  <form role="form" id="reply_input_form"
                    ng-submit="replyComment(comment_for_reply.comment_id, reply_message, user_info.user_id)">
                    <input type="hidden" ng-value="comment_for_reply.comment_id" id="comment_id_input"
                      ng-model="reply_comment_id">
                    <textarea name="" id="" class="form-control" placeholder="Type here ..." ng-model="reply_message"
                      required>
                </textarea>


                    <div class="modal-footer">
                      <button type="submit" class="btn btn-default">Reply</button>
                      <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- End modal -->




    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    $('#attachment-icon').click(function (e) {
      e.preventDefault();
      var attachment = $('#attachment-file').val();


    });
  });
</script>